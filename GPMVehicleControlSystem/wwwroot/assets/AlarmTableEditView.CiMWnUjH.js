import{_ as Z,S as p,T as E,V as j,W as H,e as K,g as ee,c as S,o as y,a as i,h as ae,f as A,b as o,X as f,Y as le,L as oe,w as s,d as h,Z as te,$ as se,a0 as ne,a1 as re,a2 as ie,a3 as ue,a4 as ce,a5 as de,t as x,a6 as pe,a7 as me,B as _e,C as ve,E as fe,a8 as M,a9 as m,p as Ce,l as he,aa as ge}from"./index.Bd-_1OqK.js";const q=g=>(Ce("data-v-e8450432"),g=g(),he(),g),be={class:"alarm-edit-container"},we={class:"header-section"},ye={class:"title-section"},Ve=q(()=>i("h1",{class:"page-title"},"Alarm Table Edit",-1)),Ne={class:"action-buttons"},ke={class:"alert-content"},De=q(()=>i("span",null,"您有未保存的修改，請記得儲存",-1)),Ee={class:"table-section"},Se={class:"search-section"},Ae={key:0,class:"search-result-count"},xe={class:"code-cell"},Ie={key:0,class:"error-message"},Le={class:"dialog-footer"},Te={__name:"AlarmTableEditView",setup(g){const J=ge(),u=p([]),C=p([]),b=p(!1),V=p(!1),_=p(""),w=p(!1),c=p(!1),t=p({Code:null,Description:"",CN:""}),I=E(()=>{if(!_.value||_.value.trim()==="")return u.value;const a=_.value.toLowerCase().trim();return u.value.filter(e=>{const l=String(e.Code||"").toLowerCase(),r=String(e.Description||"").toLowerCase(),d=String(e.CN||"").toLowerCase();return l.includes(a)||r.includes(a)||d.includes(a)})}),O=E(()=>{if(C.value.length===0)return!1;if(u.value.length!==C.value.length)return!0;const a=new Map,e=new Map;u.value.forEach(l=>{a.set(l.Code,l)}),C.value.forEach(l=>{e.set(l.Code,l)});for(const l of a.keys())if(!e.has(l))return!0;for(const l of e.keys())if(!a.has(l))return!0;for(const[l,r]of a.entries()){const d=e.get(l);if(!d||r.Code!==d.Code||String(r.Description||"").trim()!==String(d.Description||"").trim()||String(r.CN||"").trim()!==String(d.CN||"").trim())return!0}return!1}),L=async()=>{try{b.value=!0;const a=await M.GetAlarmTable(),e=l=>JSON.parse(JSON.stringify(l));u.value=a.map(e),C.value=a.map(e)}catch(a){console.error("獲取 alarm 列表失敗:",a),m.error("獲取數據失敗，請稍後再試")}finally{b.value=!1}},F=async()=>{await L(),m.success("數據已重新載入")},R=async()=>{try{V.value=!0;const a=await M.SaveAlarmList(u.value);a.success?(C.value=u.value.map(e=>JSON.parse(JSON.stringify(e))),m.success("保存成功")):m.error(a.message||"保存失敗")}catch(a){console.error("保存失敗:",a),m.error("保存失敗，請稍後再試")}finally{V.value=!1}},$=()=>{J.push({name:"home"})},z=((a,e)=>{let l;return(...r)=>{clearTimeout(l),l=setTimeout(()=>a.apply(null,r),e)}})(()=>{if(t.value.Code===null||t.value.Code===""){c.value=!1;return}const a=Number(t.value.Code);c.value=u.value.some(e=>e.Code===a)},500);j(()=>t.value.Code,a=>{if(a===null||a===""){c.value=!1;return}z()});const T=E(()=>t.value.Code!==null&&t.value.Code!==""&&t.value.Description.trim()!==""&&t.value.CN.trim()!==""&&!c.value),G=()=>{t.value={Code:null,Description:"",CN:""},c.value=!1,w.value=!0},B=()=>{w.value=!1,t.value={Code:null,Description:"",CN:""},c.value=!1},P=()=>{if(!T.value){m.warning("請填寫所有欄位，並確保 Code 不存在");return}if(c.value){m.warning(`Code ${t.value.Code} 已存在，無法新增`);return}u.value.push({Code:Number(t.value.Code),Description:t.value.Description.trim(),CN:t.value.CN.trim()}),m.success("新增成功"),B()},U=()=>{};return H(()=>{L()}),(a,e)=>{const l=oe,r=ie,d=ue,v=de,N=pe,Q=me,k=ve,W=_e,X=fe,Y=ee;return K((y(),S("div",be,[i("div",we,[i("div",ye,[o(l,{type:"default",onClick:$,icon:f(le),circle:"",class:"back-button"},null,8,["icon"]),Ve]),i("div",Ne,[o(l,{type:"success",onClick:G,icon:f(te)},{default:s(()=>[h(" 新增 ")]),_:1},8,["icon"]),o(l,{type:"info",onClick:F,loading:b.value,icon:f(se)},{default:s(()=>[h(" 重新載入 ")]),_:1},8,["loading","icon"]),o(l,{type:"primary",onClick:R,loading:V.value,icon:f(ne)},{default:s(()=>[h(" 儲存 ")]),_:1},8,["loading","icon"])])]),O.value?(y(),ae(d,{key:0,type:"warning",closable:!1,class:"unsaved-alert"},{title:s(()=>[i("span",ke,[o(r,{class:"alert-icon"},{default:s(()=>[o(f(re))]),_:1}),De])]),_:1})):A("",!0),i("div",Ee,[i("div",Se,[o(v,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=n=>_.value=n),placeholder:"搜尋 Code、Description 或 CN",clearable:"",class:"search-input"},{prefix:s(()=>[o(r,null,{default:s(()=>[o(f(ce))]),_:1})]),_:1},8,["modelValue"]),_.value?(y(),S("span",Ae," 找到 "+x(I.value.length)+" 筆結果 ",1)):A("",!0)]),o(Q,{data:I.value,border:"",stripe:"",size:"default","row-key":"Code",style:{width:"100%"},"highlight-current-row":!0,"empty-text":"暫無數據",height:"calc(100vh - 300px)",class:"dark-table"},{default:s(()=>[o(N,{prop:"Code",label:"Code",width:"120",align:"center"},{default:s(n=>[i("span",xe,x(n.row.Code),1)]),_:1}),o(N,{prop:"Description",label:"Description","min-width":"200"},{default:s(n=>[o(v,{modelValue:n.row.Description,"onUpdate:modelValue":D=>n.row.Description=D,placeholder:"請輸入 Description",clearable:"",onBlur:U},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(N,{prop:"CN",label:"CN","min-width":"200"},{default:s(n=>[o(v,{modelValue:n.row.CN,"onUpdate:modelValue":D=>n.row.CN=D,placeholder:"請輸入 CN",clearable:"",onBlur:U},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["data"])]),o(X,{modelValue:w.value,"onUpdate:modelValue":e[4]||(e[4]=n=>w.value=n),title:"新增 Alarm",width:"500px",class:"dark-dialog"},{footer:s(()=>[i("span",Le,[o(l,{onClick:B},{default:s(()=>[h("取消")]),_:1}),o(l,{type:"primary",onClick:P,disabled:c.value||!T.value},{default:s(()=>[h(" 確認 ")]),_:1},8,["disabled"])])]),default:s(()=>[o(W,{model:t.value,"label-width":"100px","label-position":"left"},{default:s(()=>[o(k,{label:"Code",required:""},{default:s(()=>[o(v,{modelValue:t.value.Code,"onUpdate:modelValue":e[1]||(e[1]=n=>t.value.Code=n),modelModifiers:{number:!0},type:"number",placeholder:"請輸入 Code"},null,8,["modelValue"]),c.value?(y(),S("div",Ie," Code "+x(t.value.Code)+" 已存在於當前數據中 ",1)):A("",!0)]),_:1}),o(k,{label:"Description",required:""},{default:s(()=>[o(v,{modelValue:t.value.Description,"onUpdate:modelValue":e[2]||(e[2]=n=>t.value.Description=n),placeholder:"請輸入 Description"},null,8,["modelValue"])]),_:1}),o(k,{label:"CN",required:""},{default:s(()=>[o(v,{modelValue:t.value.CN,"onUpdate:modelValue":e[3]||(e[3]=n=>t.value.CN=n),placeholder:"請輸入 CN"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])),[[Y,b.value]])}}},qe=Z(Te,[["__scopeId","data-v-e8450432"]]);export{qe as default};
